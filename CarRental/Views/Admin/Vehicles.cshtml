@model IEnumerable<CarRental.Models.Vehicle>
@{
    ViewData["Title"] = "Manage Vehicles";
    Layout = "_AdminLayout";
}

<div class="container-fluid py-4" style="background-image: url('https://images.unsplash.com/photo-1503376780353-7e6692767b70?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80'); background-size: cover; background-position: center; background-color: #D9D9D9; position: relative;">
    <!-- Overlay to improve text readability -->
    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.6);"></div>
    <!-- Content with relative positioning to appear above overlay -->
    <div style="position: relative; z-index: 1;">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-white"><i class="fas fa-car"></i> Manage Vehicles</h1>
            <a href="/Admin/CreateVehicle" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add New Vehicle
            </a>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped" style="color: #fff;">
                        <thead>
                            <tr style="color: #fff;">
                                <th>ID</th>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Seats</th>
                                <th>Price/Day</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var vehicle in Model)
                            {
                                <tr style="color: #fff;">
                                    <td>@vehicle.VehicleID</td>
                                    <td>
                                        <img src="@(string.IsNullOrEmpty(vehicle.ImageUrl) ? "/images/default-car.jpg" : vehicle.ImageUrl)" 
                                             alt="@vehicle.Name" style="width: 50px; height: 50px; object-fit: cover;" class="rounded">
                                    </td>
                                    <td>@vehicle.Name</td>
                                    <td><span class="badge bg-primary">@vehicle.Type</span></td>
                                    <td>@vehicle.Seats</td>
                                    <td>Rs. @vehicle.PricePerDay.ToString("N0")</td>
                                    <td>
                                        @if (vehicle.Latitude != 0 && vehicle.Longitude != 0)
                                        {
                                            <small class="text-light">
                                                @vehicle.Latitude.ToString("F4"), @vehicle.Longitude.ToString("F4")
                                            </small>
                                        }
                                        else
                                        {
                                            <small class="text-light">Not set</small>
                                        }
                                    </td>
                                    <td>
                                        <span class="badge @(vehicle.IsAvailable ? "bg-success" : "bg-danger")">
                                            @(vehicle.IsAvailable ? "Available" : "Not Available")
                                        </span>
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <a href="/Vehicle/Details/@vehicle.VehicleID" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="/Admin/EditVehicle/@vehicle.VehicleID" class="btn btn-sm btn-outline-warning">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <form method="post" action="/Admin/DeleteVehicle/@vehicle.VehicleID" 
                                                  style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this vehicle?')">
                                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Check if background image loads, fallback to color if it fails
    const container = document.querySelector('.container-fluid');
    const img = new Image();
    img.src = 'https://images.wallspic.com/image/207134/bmw_m4-bmw-car-vehicle-luxury_car-3840x2160.jpg';
    img.onerror = () => {
        container.style.backgroundImage = 'none';
        container.style.backgroundColor = '#D9D9D9';
    };
</script>